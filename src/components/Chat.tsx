import {useContext, useEffect, useState} from "react";
import {ServerContext} from "../main.tsx";
import MessageComponent from "./Message.tsx";
import getMessages from "../hooks/getMessages.ts";
import {Message} from "../types.ts";

const Chat = ({channelIndex}: { channelIndex: number }) => {
    const server = useContext(ServerContext);
    const channel = server?.channels[channelIndex];
    const [currentMessage, setCurrentMessage] = useState<string>("");
    const [messages, setMessages] = useState<Message[] | null>()

    useEffect(() => {
        getMessages(channel).then(res => setMessages(res));
    }, []);

    return (
        <div id={"chat"}>
            <div id="messages">
                {messages ? messages.map((message, index) => <MessageComponent message={message}
                                                                               key={index}/>) : "loading messages..."}
                <div id="anchor"></div>
            </div>
            <div id="chatbox">
                <input type="text" placeholder={"メッセージを送信"} value={currentMessage} onChange={e => {
                    setCurrentMessage(e.target.value);
                }} onKeyDown={e => {
                    if (e.key == "Enter") {
                        alert("hi :3")
                    }
                }}/>
                <span>@</span>
                <span>Aa</span>
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" fill="none">
                    <path
                        d="M14.1667 2.78332C15.4236 3.50904 16.4692 4.55043 17.1999 5.80441C17.9307 7.05839 18.3212 8.48147 18.3329 9.93277C18.3447 11.3841 17.9771 12.8133 17.2668 14.0789C16.5564 15.3445 15.5278 16.4027 14.2828 17.1486C13.0378 17.8945 11.6196 18.3023 10.1685 18.3317C8.71744 18.3611 7.28387 18.011 6.00971 17.316C4.73555 16.6211 3.66497 15.6054 2.90397 14.3696C2.14297 13.1337 1.71792 11.7206 1.67091 10.27L1.66675 9.99999L1.67091 9.72999C1.71758 8.29082 2.13637 6.88829 2.88645 5.65915C3.63652 4.43001 4.69229 3.4162 5.95082 2.71656C7.20936 2.01692 8.6277 1.65532 10.0676 1.66702C11.5075 1.67872 12.9198 2.06332 14.1667 2.78332ZM12.6667 11.905C12.5089 11.7503 12.2961 11.6646 12.0752 11.6668C11.8542 11.669 11.6431 11.7589 11.4884 11.9167C11.2944 12.1147 11.0629 12.272 10.8073 12.3795C10.5517 12.4869 10.2773 12.5422 10.0001 12.5422C9.72286 12.5422 9.44842 12.4869 9.19286 12.3795C8.93729 12.272 8.70573 12.1147 8.51175 11.9167C8.35625 11.7625 8.14633 11.6758 7.92738 11.6752C7.70843 11.6746 7.49804 11.7601 7.34169 11.9134C7.18534 12.0667 7.0956 12.2754 7.09187 12.4943C7.08814 12.7132 7.17071 12.9248 7.32175 13.0833C7.6709 13.4396 8.08762 13.7226 8.54752 13.9159C9.00741 14.1091 9.50124 14.2086 10.0001 14.2086C10.4989 14.2086 10.9927 14.1091 11.4526 13.9159C11.9125 13.7226 12.3293 13.4396 12.6784 13.0833C12.8331 12.9255 12.9188 12.7127 12.9166 12.4917C12.9144 12.2708 12.8245 12.0597 12.6667 11.905ZM7.50842 7.49999L7.40258 7.50583C7.19167 7.53091 6.99829 7.63559 6.86197 7.79846C6.72564 7.96134 6.65666 8.17013 6.6691 8.38216C6.68155 8.5942 6.77449 8.79348 6.92894 8.93928C7.08339 9.08509 7.28768 9.16642 7.50008 9.16666L7.60592 9.16082C7.81683 9.13574 8.0102 9.03106 8.14653 8.86819C8.28285 8.70531 8.35184 8.49652 8.33939 8.28449C8.32694 8.07245 8.234 7.87317 8.07956 7.72737C7.92511 7.58156 7.72081 7.50023 7.50842 7.49999ZM12.5084 7.49999L12.4026 7.50583C12.1917 7.53091 11.9983 7.63559 11.862 7.79846C11.7256 7.96134 11.6567 8.17013 11.6691 8.38216C11.6816 8.5942 11.7745 8.79348 11.9289 8.93928C12.0834 9.08509 12.2877 9.16642 12.5001 9.16666L12.6059 9.16082C12.8168 9.13574 13.0102 9.03106 13.1465 8.86819C13.2829 8.70531 13.3518 8.49652 13.3394 8.28449C13.3269 8.07245 13.234 7.87317 13.0796 7.72737C12.9251 7.58156 12.7208 7.50023 12.5084 7.49999Z"
                        fill="#88829B"/>
                </svg>
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" fill="none">
                    <path
                        d="M9.99992 1.66666L10.0974 1.67249C10.2834 1.69443 10.4566 1.77839 10.5891 1.91083C10.7215 2.04328 10.8055 2.21648 10.8274 2.40249L10.8333 2.49999V5.83332L10.8374 5.95832C10.8672 6.35513 11.038 6.72818 11.319 7.01002C11.5999 7.29185 11.9724 7.46388 12.3691 7.49499L12.4999 7.49999H15.8333L15.9308 7.50582C16.1168 7.52776 16.29 7.61172 16.4224 7.74417C16.5549 7.87661 16.6388 8.04981 16.6608 8.23582L16.6666 8.33332V15.8333C16.6666 16.471 16.423 17.0846 15.9855 17.5485C15.5481 18.0125 14.9498 18.2917 14.3133 18.3292L14.1666 18.3333H5.83325C5.19558 18.3334 4.58199 18.0897 4.11803 17.6523C3.65408 17.2148 3.37483 16.6166 3.33742 15.98L3.33325 15.8333V4.16666C3.33322 3.52898 3.57686 2.91539 4.01432 2.45144C4.45179 1.98748 5.05001 1.70823 5.68659 1.67082L5.83325 1.66666H9.99992Z"
                        fill="#88829B"/>
                    <path d="M15.8334 5.83334H12.5001L12.4993 2.49918L15.8334 5.83334Z" fill="#88829B"/>
                </svg>
            </div>
        </div>
    );
};

export default Chat;